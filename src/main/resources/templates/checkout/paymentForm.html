<div class="payment-form-card card" th:fragment="paymentForm">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h4 class="section-title mb-0">Payment Information</h4>
            <small class="text-muted">Step 3 of 3</small>
        </div>

        <form th:action="@{'~/submitpayment'}" method="POST" id="paymentForm">
            <!-- Payment Method Selection -->
            <div class="form-section mb-4">
                <h5 class="subsection-title">Select Payment Method</h5>
                <div class="payment-methods">
                    <div class="payment-method-option">
                        <input type="radio" name="paymentMethod" value="creditCard" id="creditCard" checked class="payment-method-radio">
                        <label for="creditCard" class="payment-method-label">
                            <div class="payment-method-content">
                                <div class="payment-method-icon">
                                    <i class="bi bi-credit-card fs-2"></i>
                                </div>
                                <div class="payment-method-info">
                                    <div class="method-name">Credit Card</div>
                                    <div class="method-description">Visa, Mastercard, American Express</div>
                                </div>
                            </div>
                            <div class="payment-icons">
                                <i class="bi bi-credit-card-2-front"></i>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Payment Details -->
            <div class="form-section mb-4">
                <h5 class="subsection-title">Payment Details</h5>
                <div class="payment-details">
                    <!-- Stripe Payment Element -->
                    <div id="paymentElement"
                        th:data-create-payment-intent-url="@{'~/create-payment-intent'}"
                        th:data-update-payment-intent-url="@{'~/update-payment-intent'}"
                        th:data-return-url="@{'~/stripe-return'}"
                        th:data-stripe-api-key="${stripeApiKey}"
                        class="stripe-element">
                    </div>
                    <div id="stripeError" class="error-message mt-2"></div>
                    
                    <!-- Stripe Submit Button (Hidden by default) -->
                    <button type="button" class="btn btn-primary btn-lg w-100 mt-3 stripe-submit d-none">
                        <i class="bi bi-lock me-2"></i>
                        Complete Secure Payment
                    </button>
                </div>
            </div>

            <!-- Security Notice -->
            <div class="security-notice mb-4">
                <div class="notice-content">
                    <i class="bi bi-shield-check text-success me-2"></i>
                    <span>Your payment information is encrypted and secure</span>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-outline-secondary me-2 back-to-review">
                    <i class="bi bi-arrow-left me-1"></i>
                    Back to Review
                </button>
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="bi bi-lock me-2"></i>
                    Complete Order
                </button>
            </div>
        </form>
    </div>
</div>